<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller PHP - Aplicaciones Matem√°ticas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Men√∫ Principal -->
        <div class="menu" id="mainMenu">
            <h1>üßÆ Taller PHP - Aplicaciones Matem√°ticas</h1>
            <p>Seleccione una de las siguientes opciones:</p>
            
            <div class="menu-options">
                <a href="#" onclick="showSection('acronym')" class="menu-option">
                    <h3>üî§ Generador de Acr√≥nimos</h3>
                    <p>Convierte frases largas en acr√≥nimos. Ej: "Portable Network Graphics" ‚Üí "PNG"</p>
                </a>
                
                <a href="#" onclick="showSection('math')" class="menu-option">
                    <h3>üî¢ Fibonacci y Factorial</h3>
                    <p>Calcula sucesi√≥n de Fibonacci o factorial de un n√∫mero dado</p>
                </a>
                
                <a href="#" onclick="showSection('statistics')" class="menu-option">
                    <h3>üìä Estad√≠sticas</h3>
                    <p>Calcula promedio, mediana y moda de una serie de n√∫meros</p>
                </a>
            </div>
        </div>

        <!-- Secci√≥n de Acr√≥nimos -->
        <div id="acronymSection" class="section" style="display: none;">
            <div class="nav">
                <a href="#" onclick="showSection('menu')">‚Üê Volver al Men√∫</a>
            </div>
            
            <div class="form-section">
                <h2>üî§ Generador de Acr√≥nimos</h2>
                <p>Convierte una frase en su acr√≥nimo. Los guiones son separadores de palabras.</p>
                
                <form onsubmit="generateAcronym(event)">
                    <div class="form-group">
                        <label for="phrase">Ingrese una frase:</label>
                        <input 
                            type="text" 
                            id="phrase" 
                            placeholder="Ej: Portable Network Graphics"
                            required
                        >
                    </div>
                    
                    <button type="submit" class="btn">Generar Acr√≥nimo</button>
                </form>
                
                <div id="acronymResult" class="result-section" style="display: none;">
                    <h3>‚úÖ Acr√≥nimo generado:</h3>
                    <div class="result-value" id="acronymValue"></div>
                </div>
                
                <div class="examples">
                    <h3>üí° Ejemplos de uso:</h3>
                    <div class="example">
                        <strong>As Soon As Possible</strong> ‚Üí <strong>ASAP</strong>
                    </div>
                    <div class="example">
                        <strong>Liquid-crystal display</strong> ‚Üí <strong>LCD</strong>
                    </div>
                    <div class="example">
                        <strong>Thank George It's Friday!</strong> ‚Üí <strong>TGIF</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Matem√°ticas -->
        <div id="mathSection" class="section" style="display: none;">
            <div class="nav">
                <a href="#" onclick="showSection('menu')">‚Üê Volver al Men√∫</a>
            </div>
            
            <div class="form-section">
                <h2>üî¢ Fibonacci y Factorial</h2>
                <p>Calcula la sucesi√≥n de Fibonacci o el factorial de un n√∫mero.</p>
                
                <form onsubmit="calculateMath(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mathNumber">N√∫mero:</label>
                            <input 
                                type="number" 
                                id="mathNumber" 
                                min="0"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="operation">Operaci√≥n:</label>
                            <select id="operation" required>
                                <option value="">Seleccione...</option>
                                <option value="fibonacci">Sucesi√≥n de Fibonacci</option>
                                <option value="factorial">Factorial</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">Calcular</button>
                </form>
                
                <div id="mathResult" class="result-section" style="display: none;">
                    <h3>‚úÖ Resultado:</h3>
                    <div id="mathValue"></div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Estad√≠sticas -->
        <div id="statisticsSection" class="section" style="display: none;">
            <div class="nav">
                <a href="#" onclick="showSection('menu')">‚Üê Volver al Men√∫</a>
            </div>
            
            <div class="form-section">
                <h2>üìä Estad√≠sticas</h2>
                <p>Calcula promedio, mediana y moda de una serie de n√∫meros.</p>
                
                <div class="numbers-input">
                    <label for="newNumber">Agregar n√∫mero:</label>
                    <input 
                        type="number" 
                        id="newNumber" 
                        step="any"
                        placeholder="Ingrese un n√∫mero"
                    >
                    <button type="button" class="add-number-btn" onclick="addNumber()">Agregar</button>
                </div>
                
                <div class="numbers-list" id="numbersList">
                    <!-- Los n√∫meros se mostrar√°n aqu√≠ -->
                </div>
                
                <button type="button" class="btn" onclick="calculateStatistics()">Calcular Estad√≠sticas</button>
                
                <div id="statsResult" class="result-section" style="display: none;">
                    <h3>‚úÖ Resultados:</h3>
                    <div id="statsValue"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let numbers = [];
        let db;

        // Inicializar IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('TallerPHP', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('calculations')) {
                        db.createObjectStore('calculations', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // Mostrar secci√≥n espec√≠fica
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById('mainMenu').style.display = 'none';
            
            // Mostrar la secci√≥n seleccionada
            if (sectionName === 'menu') {
                document.getElementById('mainMenu').style.display = 'block';
            } else {
                document.getElementById(sectionName + 'Section').style.display = 'block';
            }
        }

        // Generar acr√≥nimo
        function generateAcronym(event) {
            event.preventDefault();
            
            const phrase = document.getElementById('phrase').value;
            const result = createAcronym(phrase);
            
            document.getElementById('acronymValue').textContent = result;
            document.getElementById('acronymResult').style.display = 'block';
            
            // Guardar en IndexedDB
            saveCalculation('acronym', { phrase, result });
        }

        // Crear acr√≥nimo
        function createAcronym(phrase) {
            // Limpiar texto eliminando signos de puntuaci√≥n excepto guiones
            let cleaned = phrase.replace(/[^\w\s\-]/g, '');
            
            // Normalizar separadores (convertir guiones en espacios)
            cleaned = cleaned.replace(/[\s\-]+/g, ' ');
            
            // Dividir en palabras y generar acr√≥nimo
            const words = cleaned.split(' ').filter(word => word.length > 0);
            return words.map(word => word.charAt(0).toUpperCase()).join('');
        }

        // Calcular matem√°ticas
        function calculateMath(event) {
            event.preventDefault();
            
            const number = parseInt(document.getElementById('mathNumber').value);
            const operation = document.getElementById('operation').value;
            
            let result;
            if (operation === 'fibonacci') {
                result = calculateFibonacci(number).join(', ');
                document.getElementById('mathValue').innerHTML = `<div class="result-list">${result}</div>`;
            } else {
                result = calculateFactorial(number);
                document.getElementById('mathValue').innerHTML = `<div class="result-value">${result}</div>`;
            }
            
            document.getElementById('mathResult').style.display = 'block';
            
            // Guardar en IndexedDB
            saveCalculation('math', { number, operation, result });
        }

        // Calcular Fibonacci
        function calculateFibonacci(n) {
            if (n < 0) throw new Error("El n√∫mero debe ser positivo");
            if (n === 0) return [0];
            if (n === 1) return [0, 1];
            
            const fibonacci = [0, 1];
            for (let i = 2; i <= n; i++) {
                fibonacci.push(fibonacci[i - 1] + fibonacci[i - 2]);
            }
            return fibonacci;
        }

        // Calcular Factorial
        function calculateFactorial(n) {
            if (n < 0) throw new Error("El n√∫mero debe ser positivo");
            if (n === 0 || n === 1) return 1;
            
            let factorial = 1;
            for (let i = 2; i <= n; i++) {
                factorial *= i;
            }
            return factorial;
        }

        // Agregar n√∫mero a la lista
        function addNumber() {
            const input = document.getElementById('newNumber');
            const number = parseFloat(input.value);
            
            if (!isNaN(number)) {
                numbers.push(number);
                updateNumbersList();
                input.value = '';
            }
        }

        // Actualizar lista de n√∫meros
        function updateNumbersList() {
            const list = document.getElementById('numbersList');
            list.innerHTML = '';
            
            numbers.forEach((number, index) => {
                const span = document.createElement('span');
                span.className = 'number-item';
                span.innerHTML = number + '<button type="button" class="remove-number" onclick="removeNumber(' + index + ')">√ó</button>';
                list.appendChild(span);
            });
        }

        // Remover n√∫mero de la lista
        function removeNumber(index) {
            numbers.splice(index, 1);
            updateNumbersList();
        }

        // Calcular estad√≠sticas
        function calculateStatistics() {
            if (numbers.length === 0) {
                alert('Por favor, agregue al menos un n√∫mero.');
                return;
            }
            
            const average = numbers.reduce((sum, num) => sum + num, 0) / numbers.length;
            const median = calculateMedian([...numbers].sort((a, b) => a - b));
            const mode = calculateMode(numbers);
            
            let result = `Promedio: ${average.toFixed(2)}\n`;
            result += `Mediana: ${median.toFixed(2)}\n`;
            
            if (mode.length === 0) {
                result += 'Moda: No hay moda (todos los n√∫meros aparecen una vez)';
            } else {
                result += `Moda: ${mode.join(', ')}`;
            }
            
            document.getElementById('statsValue').innerHTML = `<div class="result-list">${result.replace(/\n/g, '<br>')}</div>`;
            document.getElementById('statsResult').style.display = 'block';
            
            // Guardar en IndexedDB
            saveCalculation('statistics', { numbers: [...numbers], average, median, mode });
        }

        // Calcular mediana
        function calculateMedian(sortedNumbers) {
            const count = sortedNumbers.length;
            if (count % 2 === 0) {
                return (sortedNumbers[count / 2 - 1] + sortedNumbers[count / 2]) / 2;
            } else {
                return sortedNumbers[Math.floor(count / 2)];
            }
        }

        // Calcular moda
        function calculateMode(numbers) {
            const frequency = {};
            numbers.forEach(num => {
                frequency[num] = (frequency[num] || 0) + 1;
            });
            
            const maxFrequency = Math.max(...Object.values(frequency));
            if (maxFrequency === 1) return [];
            
            return Object.keys(frequency)
                .filter(num => frequency[num] === maxFrequency)
                .map(num => parseFloat(num));
        }

        // Guardar c√°lculo en IndexedDB
        function saveCalculation(type, data) {
            if (!db) return;
            
            const transaction = db.transaction(['calculations'], 'readwrite');
            const store = transaction.objectStore('calculations');
            
            const calculation = {
                type: type,
                data: data,
                timestamp: new Date().toISOString()
            };
            
            store.add(calculation);
        }

        // Cargar c√°lculos guardados
        function loadCalculations() {
            if (!db) return;
            
            const transaction = db.transaction(['calculations'], 'readonly');
            const store = transaction.objectStore('calculations');
            const request = store.getAll();
            
            request.onsuccess = () => {
                console.log('C√°lculos guardados:', request.result);
            };
        }

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await initDB();
                loadCalculations();
            } catch (error) {
                console.error('Error inicializando IndexedDB:', error);
            }
        });
    </script>
</body>
</html>
